; generated by Component: ARM Compiler 5.06 update 6 (build 750) Tool: ArmCC [4d3637]
; commandline ArmCC [--list --split_sections --debug -c --asm --interleave -o..\output\tim6.o --asm_dir=..\Listing\ --list_dir=..\Listing\ --depend=..\output\tim6.d --cpu=Cortex-M4.fp --apcs=interwork -O1 --diag_suppress=9931,870 -I..\APP -I..\drive -I..\Include -I..\Libraries\CMSIS\inc -I..\Libraries\CMSIS\src -I..\Libraries\FWlib\inc -I..\Libraries\FWlib\src -I..\Listing -I..\Output -I..\Project -I..\STemWinLibrary522\Config -I..\STemWinLibrary522\emWinTask -I..\STemWinLibrary522\GUILib -I..\STemWinLibrary522\inc -I..\User -I..\USB\STM32_USB_HOST_Library\Class\HID\inc -I..\USB\STM32_USB_HOST_Library\Class\MSC\src -I..\USB\STM32_USB_HOST_Library\Core\src -I..\USB\USB_APP -I..\USB\STM32_USB_HOST_Library\Class\HID\src -I..\USB\STM32_USB_HOST_Library\Class\MSC\inc -I..\USB\STM32_USB_HOST_Library\Core\inc -I..\USB\STM32_USB_OTG_Driver\inc -I..\FATFS\exfuns -I..\FATFS\src\option -I..\FATFS\src -I..\MALLOC -ID:\Keil_v5\ARM\RV31\INC -ID:\Keil_v5\ARM\CMSIS\Include -ID:\Keil_v5\ARM\INC\ST\STM32F4xx -D__UVISION_VERSION=525 -DUSE_STDPERIPH_DRIVER -DSTM32F40XX -DUSE_USB_OTG_FS -DUSE_EMBEDDED_PHY -DUSE_USB_OTG_HS -DSTM32F40XX --omf_browse=..\output\tim6.crf --no_multibyte_chars ..\drive\TIM6.c]
                          THUMB

                          AREA ||i.MODS_Poll||, CODE, READONLY, ALIGN=2

                  MODS_Poll PROC
;;;615    
;;;616    void MODS_Poll(void)
000000  b510              PUSH     {r4,lr}
;;;617    {
;;;618    	uint16_t addr;
;;;619    	static uint16_t crc1;
;;;620        static u32 testi;
;;;621    	/* è¶…è¿‡3.5ä¸ªå­—ç¬¦æ—¶é—´åŽæ‰§è¡ŒMODH_RxTimeOut()å‡½æ•°ã€‚å…¨å±€å˜é‡ g_rtu_timeout = 1; é€šçŸ¥ä¸»ç¨‹åºå¼€å§‹è§£ç ?*/
;;;622    //	if (g_mods_timeout == 0)	
;;;623    //	{
;;;624    //		return;								/* æ²¡æœ‰è¶…æ—¶ï¼Œç»§ç»­æŽ¥æ”¶ã€‚ä¸è¦æ¸…é›?g_tModS.RxCount */
;;;625    //	}
;;;626    
;;;627        testi=g_tModS.RxCount;
000002  4c13              LDR      r4,|L1.80|
000004  4a13              LDR      r2,|L1.84|
000006  f894009e          LDRB     r0,[r4,#0x9e]  ; g_tModS
00000a  6250              STR      r0,[r2,#0x24]  ; testi
;;;628        testi=g_tModS.RxCount;
;;;629        testi=g_tModS.RxCount;
;;;630    	if(testi>7)				/* ½ÓÊÕµ½µÄÊý¾ÝÐ¡ÓÚ4¸ö×Ö½Ú¾ÍÈÏÎª´íÎó */
;;;631    	{
;;;632    		testi=testi;
;;;633    	}
;;;634    	testi=g_tModS.RxCount;
;;;635        if(testi==8)				/* ½ÓÊÕµ½µÄÊý¾ÝÐ¡ÓÚ4¸ö×Ö½Ú¾ÍÈÏÎª´íÎó */
00000c  2808              CMP      r0,#8
00000e  d101              BNE      |L1.20|
;;;636    	{
;;;637    		testi=testi+1;
000010  2109              MOVS     r1,#9
000012  6251              STR      r1,[r2,#0x24]  ; testi
                  |L1.20|
;;;638    	}
;;;639    	//ÅÐ¶ÏÍ¨Ñ¶½ÓÊÕÊÇ·ñ³¬Ê±
;;;640    	if(OldTick!=Tick_10ms)
000014  6b53              LDR      r3,[r2,#0x34]  ; OldTick
000016  6911              LDR      r1,[r2,#0x10]  ; Tick_10ms
000018  428b              CMP      r3,r1
00001a  d014              BEQ      |L1.70|
;;;641      	{  
;;;642    	  OldTick=Tick_10ms;
00001c  6351              STR      r1,[r2,#0x34]  ; OldTick
;;;643    	   if(g_mods_timeout>0)
00001e  4a0e              LDR      r2,|L1.88|
000020  7811              LDRB     r1,[r2,#0]  ; g_mods_timeout
000022  b109              CBZ      r1,|L1.40|
;;;644          { 
;;;645    	    g_mods_timeout--;
000024  1e49              SUBS     r1,r1,#1
000026  7011              STRB     r1,[r2,#0]
                  |L1.40|
;;;646          }
;;;647    	  if(g_mods_timeout==0 && g_tModS.RxCount>0)   //ÓÐÊýµ«³¬Ê±ÁË
000028  7811              LDRB     r1,[r2,#0]  ; g_mods_timeout
00002a  2900              CMP      r1,#0
00002c  d10b              BNE      |L1.70|
00002e  2800              CMP      r0,#0
000030  d009              BEQ      |L1.70|
;;;648          { 
;;;649    		// goto err_ret;
;;;650    	
;;;651          }
;;;652          else if(g_mods_timeout==0 && g_tModS.RxCount==0) //Ã»Êý³¬Ê±ÁË
;;;653             return;
;;;654          else //Ã»³¬Ê±ÁË£¬¼ÌÐøÊÕ
;;;655             return;
;;;656    	}
;;;657    	else   //Ã»ÓÐµ½10ms£¬²»½øÈë½âÎö
;;;658    		return;
;;;659    	//g_mods_timeout = 0;	 					/* Çå±êÖ¾ */
;;;660    
;;;661    	if (g_tModS.RxCount < 4)				/* ½ÓÊÕµ½µÄÊý¾ÝÐ¡ÓÚ4¸ö×Ö½Ú¾ÍÈÏÎª´íÎó */
000032  2804              CMP      r0,#4
000034  d304              BCC      |L1.64|
;;;662    	{
;;;663    		goto err_ret;
;;;664    	}
;;;665    
;;;666    	/* ¼ÆËãCRCÐ£ÑéºÍ */
;;;667    // 	crc1 = CRC16(g_tModS.RxBuf, g_tModS.RxCount);
;;;668    // 	if (crc1 != 0)
;;;669    // 	{
;;;670    // 		goto err_ret;
;;;671    // 	}
;;;672    
;;;673    // 	/* Õ¾µØÖ· (1×Ö½Ú£© */
;;;674    // 	addr = g_tModS.RxBuf[0];				/* µÚ1×Ö½Ú Õ¾ºÅ */
;;;675    // 	if (addr != SADDR485)		 			/* ÅÐ¶ÏÖ÷»ú·¢ËÍµÄÃüÁîµØÖ·ÊÇ·ñ·ûºÏ */
;;;676    // 	{
;;;677    // 		goto err_ret;
;;;678    // 	}
;;;679    
;;;680    	/* åˆ†æžåº”ç”¨å±‚åè®?*/
;;;681        if(g_tModS.RxBuf[2] == 0xA5)
000036  78a0              LDRB     r0,[r4,#2]  ; g_tModS
000038  28a5              CMP      r0,#0xa5
00003a  d005              BEQ      |L1.72|
;;;682        {
;;;683            UART_Action();
;;;684        }else{
;;;685    //        usartocflag = 1;
;;;686            RecHandle();
00003c  f7fffffe          BL       RecHandle
                  |L1.64|
;;;687        }
;;;688    							
;;;689    	
;;;690    err_ret:
;;;691    #if 0										/* æ­¤éƒ¨åˆ†ä¸ºäº†ä¸²å£æ‰“å°ç»“æž?å®žé™…è¿ç”¨ä¸­å¯ä¸è¦ */
;;;692    	g_tPrint.Rxlen = g_tModS.RxCount;
;;;693    	memcpy(g_tPrint.RxBuf, g_tModS.RxBuf, g_tModS.RxCount);
;;;694    #endif
;;;695    	
;;;696     	g_tModS.RxCount = 0;					/* å¿…é¡»æ¸…é›¶è®¡æ•°å™¨ï¼Œæ–¹ä¾¿ä¸‹æ¬¡å¸§åŒæ­?*/
000040  2000              MOVS     r0,#0
000042  f884009e          STRB     r0,[r4,#0x9e]
                  |L1.70|
;;;697    }
000046  bd10              POP      {r4,pc}
                  |L1.72|
000048  f7fffffe          BL       UART_Action
00004c  e7f8              B        |L1.64|
;;;698    
                          ENDP

00004e  0000              DCW      0x0000
                  |L1.80|
                          DCD      g_tModS
                  |L1.84|
                          DCD      ||.data||
                  |L1.88|
                          DCD      g_mods_timeout

                          AREA ||i.TIM3_IRQHandler||, CODE, READONLY, ALIGN=2

                  TIM3_IRQHandler PROC
;;;432    //??? 3 ??????
;;;433    void TIM3_IRQHandler(void)
000000  e92d47f0          PUSH     {r4-r10,lr}
;;;434    {
000004  ed2d8b02          VPUSH    {d8}
;;;435        static vu8 calert = 0;
;;;436        static vu16 resetcount;
;;;437        static vu8 read1963;
;;;438        static vu16 scancount;
;;;439        static vu32 ctime,dctime;
;;;440        
;;;441        if(TIM_GetITStatus(TIM3,TIM_IT_Update)==SET) //????
000008  2101              MOVS     r1,#1
00000a  4c92              LDR      r4,|L2.596|
00000c  4620              MOV      r0,r4
00000e  f7fffffe          BL       TIM_GetITStatus
000012  2801              CMP      r0,#1
000014  d123              BNE      |L2.94|
;;;442        {
;;;443            TIM_ClearITPendingBit(TIM3,TIM_IT_Update); //??????¦Ë
000016  2101              MOVS     r1,#1
000018  4620              MOV      r0,r4
00001a  f7fffffe          BL       TIM_ClearITPendingBit
;;;444    //         if(page_sw != face_starter)
;;;445    //         {
;;;446    //              if(resetflag == 1)
;;;447    //              {
;;;448    //                  if(resetcount == 1)
;;;449    //                  {
;;;450    //                      LCD_Initializtion();
;;;451    //                      sLCD_WR_REG(0xf1);
;;;452    //                      GUI_Init();
;;;453    //                      if(page_sw == face_menu)
;;;454    //                      {
;;;455    //                          ResetPow();
;;;456    //                      }else if(page_sw == face_cdc){
;;;457    //                          ResetCDC();
;;;458    //                      }else if(page_sw == face_r){
;;;459    //                          ResetR();
;;;460    //                      }else if(page_sw == face_load){
;;;461    //                          ResetLoad();
;;;462    //                      }else if(page_sw == face_graph){
;;;463    //                          ResetG();
;;;464    //                      }else if(page_sw == face_set){
;;;465    //                          ResetSET();
;;;466    //                      }
;;;467    //                      resdone = 1;
;;;468    // //                     resetflag = 0;
;;;469    //                      resetcount = 0;
;;;470    //                  }else{
;;;471    //                      resetcount++;
;;;472    //                  }                
;;;473    //              }
;;;474    //          }
;;;475            switch(page_sw)
00001e  488e              LDR      r0,|L2.600|
000020  f890c000          LDRB     r12,[r0,#0]  ; page_sw
000024  2600              MOVS     r6,#0
;;;476            {
;;;477                case face_menu:
;;;478                {
;;;479                    if(pow_sw == pow_on)
000026  4a8d              LDR      r2,|L2.604|
;;;480                    {
;;;481                        bc_raw += DISS_POW_Current * 1000 * 1/3600;
000028  4b8d              LDR      r3,|L2.608|
;;;482                    }else{
;;;483                        bc_raw = 0;
;;;484                    }
;;;485                }break;
;;;486                case face_cdc:
;;;487                {
;;;488                    if(mode_sw == mode_pow && cdc_sw == cdc_on)
;;;489                    {
;;;490                        ctime++;
;;;491                        second = ctime%60;//ç§’
;;;492                        minute = (ctime/60)%60;//åˆ†
;;;493                        hour   = ctime/3600;//æ—¶
;;;494                        cbc_raw += DISS_POW_Current * 1000 * 1/3600;
;;;495                        bc_raw = 0;
;;;496    //                    bc_raw += DISS_POW_Current * 1000 * 1/3600;
;;;497                    }else if(mode_sw == mode_load && cdc_sw == cdc_on){
;;;498                        dctime++;
;;;499                        second1 = dctime%60;//ç§’
;;;500                        minute1 = (dctime/60)%60;//åˆ†
;;;501                        hour1   = dctime/3600;//æ—¶
;;;502                        bc_raw += DISS_Current * 1000 * 1/3600;
00002a  4d8e              LDR      r5,|L2.612|
;;;503    //                    c_sum += DISS_Current * 1000 * 1/3600;
;;;504                        cbc_raw = 0;
;;;505                    }else if(cdc_sw == cdc_off){
;;;506                        bc_raw = 0;
;;;507                        cbc_raw = 0;
;;;508                        c_sum = 0;
;;;509                        ctime=0;
;;;510                        dctime=0;
;;;511                    }
;;;512                }break;
;;;513                case face_load:
;;;514                {
;;;515                    if(load_sw == load_on)
;;;516                    {
;;;517                        if(alert_flag == 1)
00002c  488e              LDR      r0,|L2.616|
00002e  498f              LDR      r1,|L2.620|
000030  f8df823c          LDR      r8,|L2.624|
000034  4f8f              LDR      r7,|L2.628|
000036  ed9f8a90          VLDR     s16,|L2.632|
00003a  eddf8a90          VLDR     s17,|L2.636|
00003e  ed9f0a90          VLDR     s0,|L2.640|
000042  4c90              LDR      r4,|L2.644|
000044  f1bc0f05          CMP      r12,#5                ;475
000048  d209              BCS      |L2.94|
00004a  e8dff00c          TBB      [pc,r12]              ;475
00004e  af19              DCB      0xaf,0x19
000050  03f08700          DCB      0x03,0xf0,0x87,0x00
000054  7810              LDRB     r0,[r2,#0]            ;479  ; pow_sw
000056  2801              CMP      r0,#1                 ;479
000058  d005              BEQ      |L2.102|
00005a  ed840a0a          VSTR     s0,[r4,#0x28]         ;483
                  |L2.94|
;;;518                        {
;;;519                            calert ++;
;;;520                            if(calert == 3)
;;;521                            {
;;;522                                t_onoff = 0;
;;;523                                GPIO_SetBits(GPIOA,GPIO_Pin_15);//????OFF
;;;524                                mode_sw = 0;
;;;525                                load_sw = load_off;
;;;526                                calert = 0;                                
;;;527                            }
;;;528                        }
;;;529                        bc_raw += DISS_Current * 1000 * 1/3600;
;;;530                    }else{
;;;531                        bc_raw = 0;
;;;532                    }
;;;533                }break;
;;;534                case face_graph:
;;;535                {
;;;536                    if(mode_sw == mode_pow)
;;;537                    {
;;;538                        if(pow_sw == pow_on)
;;;539                        {
;;;540                            bc_raw += DISS_POW_Current * 1000 * 1/3600;
;;;541                        }else if(mode_sw == mode_pow && cdc_sw == cdc_on)
;;;542                        {
;;;543                            bc_raw += DISS_POW_Current * 1000 * 1/3600;
;;;544                        }
;;;545                        else{
;;;546                            bc_raw = 0;
;;;547                        }
;;;548                    }               
;;;549                    
;;;550                    if(mode_sw == mode_load)
;;;551                    {
;;;552                        if(load_sw == load_on)
;;;553                        {
;;;554                            bc_raw += DISS_Current * 1000 * 1/3600;
;;;555                        }else{
;;;556                            bc_raw = 0;
;;;557                        }
;;;558                    }
;;;559                }break;
;;;560                case face_r:
;;;561                {
;;;562                    if(oct_sw == oct_on)
;;;563                    {
;;;564                        if(alert_flag == 1)
;;;565                        {
;;;566                            calert ++;
;;;567                            if(calert == 3)
;;;568                            {
;;;569                                ocstop = 1;
;;;570                                calert = 0;
;;;571                            }
;;;572                        }
;;;573                    }
;;;574                }break;
;;;575            }
;;;576    //         GPIO_ResetBits(GPIOD,GPIO_Pin_12);
;;;577    //         TM1650_SET_LED(0x48,0x71);
;;;578    //         TM1650_SET_LED(0x68,0xF2);//PASS?
;;;579        }    
;;;580        
;;;581    }
00005e  ecbd8b02          VPOP     {d8}
000062  e8bd87f0          POP      {r4-r10,pc}
                  |L2.102|
000066  ed930a00          VLDR     s0,[r3,#0]            ;481
00006a  ee200a08          VMUL.F32 s0,s0,s16             ;481
00006e  eec00a28          VDIV.F32 s1,s0,s17             ;481
000072  ed940a0a          VLDR     s0,[r4,#0x28]         ;481
000076  ee300a80          VADD.F32 s0,s1,s0              ;481
00007a  ed840a0a          VSTR     s0,[r4,#0x28]         ;481
00007e  e7ee              B        |L2.94|
000080  f897c000          LDRB     r12,[r7,#0]           ;488  ; mode_sw
000084  203c              MOVS     r0,#0x3c              ;491
000086  f44f6261          MOV      r2,#0xe10             ;493
00008a  f1bc0f03          CMP      r12,#3                ;488
00008e  d104              BNE      |L2.154|
000090  f891c000          LDRB     r12,[r1,#0]           ;488  ; cdc_sw
000094  f1bc0f01          CMP      r12,#1                ;488
000098  d003              BEQ      |L2.162|
                  |L2.154|
00009a  783b              LDRB     r3,[r7,#0]            ;497  ; mode_sw
00009c  2b02              CMP      r3,#2                 ;497
00009e  d027              BEQ      |L2.240|
0000a0  e029              B        |L2.246|
                  |L2.162|
0000a2  69e1              LDR      r1,[r4,#0x1c]         ;490  ; ctime
0000a4  1c49              ADDS     r1,r1,#1              ;490
0000a6  61e1              STR      r1,[r4,#0x1c]         ;490  ; ctime
0000a8  69e1              LDR      r1,[r4,#0x1c]         ;491  ; ctime
0000aa  fbb1f5f0          UDIV     r5,r1,r0              ;491
0000ae  fb001115          MLS      r1,r0,r5,r1           ;491
0000b2  4d75              LDR      r5,|L2.648|
0000b4  7029              STRB     r1,[r5,#0]            ;491
0000b6  69e1              LDR      r1,[r4,#0x1c]         ;492  ; ctime
0000b8  fbb1f1f0          UDIV     r1,r1,r0              ;492
0000bc  fbb1f5f0          UDIV     r5,r1,r0              ;492
0000c0  fb001015          MLS      r0,r0,r5,r1           ;492
0000c4  4971              LDR      r1,|L2.652|
0000c6  7008              STRB     r0,[r1,#0]            ;492
0000c8  69e0              LDR      r0,[r4,#0x1c]         ;493  ; ctime
0000ca  4971              LDR      r1,|L2.656|
0000cc  fbb0f0f2          UDIV     r0,r0,r2              ;493
0000d0  7008              STRB     r0,[r1,#0]            ;493
0000d2  edd30a00          VLDR     s1,[r3,#0]            ;494
0000d6  ee600a88          VMUL.F32 s1,s1,s16             ;494
0000da  ee801aa8          VDIV.F32 s2,s1,s17             ;494
0000de  edd40a0b          VLDR     s1,[r4,#0x2c]         ;494
0000e2  ee710a20          VADD.F32 s1,s2,s1              ;494
0000e6  edc40a0b          VSTR     s1,[r4,#0x2c]         ;494
0000ea  ed840a0a          VSTR     s0,[r4,#0x28]         ;495
0000ee  e7b6              B        |L2.94|
                  |L2.240|
0000f0  780b              LDRB     r3,[r1,#0]            ;497  ; cdc_sw
0000f2  2b01              CMP      r3,#1                 ;497
0000f4  d00b              BEQ      |L2.270|
                  |L2.246|
0000f6  7808              LDRB     r0,[r1,#0]            ;505  ; cdc_sw
0000f8  2800              CMP      r0,#0                 ;505
0000fa  d1b0              BNE      |L2.94|
0000fc  ed840a0a          VSTR     s0,[r4,#0x28]         ;506
000100  ed840a0b          VSTR     s0,[r4,#0x2c]         ;507
000104  ed840a0c          VSTR     s0,[r4,#0x30]         ;508
000108  61e6              STR      r6,[r4,#0x1c]         ;509  ; ctime
00010a  6226              STR      r6,[r4,#0x20]         ;510  ; dctime
                  |L2.268|
00010c  e7a7              B        |L2.94|
                  |L2.270|
00010e  6a21              LDR      r1,[r4,#0x20]         ;498  ; dctime
000110  1c49              ADDS     r1,r1,#1              ;498
000112  6221              STR      r1,[r4,#0x20]         ;498  ; dctime
000114  6a21              LDR      r1,[r4,#0x20]         ;499  ; dctime
000116  fbb1f3f0          UDIV     r3,r1,r0              ;499
00011a  fb001113          MLS      r1,r0,r3,r1           ;499
00011e  4b5d              LDR      r3,|L2.660|
000120  7019              STRB     r1,[r3,#0]            ;499
000122  6a21              LDR      r1,[r4,#0x20]         ;500  ; dctime
000124  fbb1f1f0          UDIV     r1,r1,r0              ;500
000128  fbb1f3f0          UDIV     r3,r1,r0              ;500
00012c  fb001013          MLS      r0,r0,r3,r1           ;500
000130  4959              LDR      r1,|L2.664|
000132  7008              STRB     r0,[r1,#0]            ;500
000134  6a20              LDR      r0,[r4,#0x20]         ;501  ; dctime
000136  4959              LDR      r1,|L2.668|
000138  fbb0f0f2          UDIV     r0,r0,r2              ;501
00013c  7008              STRB     r0,[r1,#0]            ;501
00013e  edd50a00          VLDR     s1,[r5,#0]            ;502
000142  ee600a88          VMUL.F32 s1,s1,s16             ;502
000146  ee801aa8          VDIV.F32 s2,s1,s17             ;502
00014a  edd40a0a          VLDR     s1,[r4,#0x28]         ;502
00014e  ee710a20          VADD.F32 s1,s2,s1              ;502
000152  edc40a0a          VSTR     s1,[r4,#0x28]         ;502
000156  ed840a0b          VSTR     s0,[r4,#0x2c]         ;504
                  |L2.346|
00015a  e780              B        |L2.94|
00015c  f8981000          LDRB     r1,[r8,#0]            ;515  ; load_sw
000160  2901              CMP      r1,#1                 ;515
000162  d002              BEQ      |L2.362|
000164  ed840a0a          VSTR     s0,[r4,#0x28]         ;531
000168  e779              B        |L2.94|
                  |L2.362|
00016a  7800              LDRB     r0,[r0,#0]            ;517  ; alert_flag
00016c  2801              CMP      r0,#1                 ;517
00016e  d110              BNE      |L2.402|
000170  78a0              LDRB     r0,[r4,#2]            ;519  ; calert
000172  1c40              ADDS     r0,r0,#1              ;519
000174  70a0              STRB     r0,[r4,#2]            ;519
000176  78a0              LDRB     r0,[r4,#2]            ;520  ; calert
000178  2803              CMP      r0,#3                 ;520
00017a  d10a              BNE      |L2.402|
00017c  4848              LDR      r0,|L2.672|
00017e  7006              STRB     r6,[r0,#0]            ;522
000180  f44f4100          MOV      r1,#0x8000            ;523
000184  4847              LDR      r0,|L2.676|
000186  f7fffffe          BL       GPIO_SetBits
00018a  703e              STRB     r6,[r7,#0]            ;524
00018c  f8886000          STRB     r6,[r8,#0]            ;525
000190  70a6              STRB     r6,[r4,#2]            ;526
                  |L2.402|
000192  ed950a00          VLDR     s0,[r5,#0]            ;529
000196  ee200a08          VMUL.F32 s0,s0,s16             ;529
00019a  eec00a28          VDIV.F32 s1,s0,s17             ;529
00019e  ed940a0a          VLDR     s0,[r4,#0x28]         ;529
0001a2  ee300a80          VADD.F32 s0,s1,s0              ;529
0001a6  ed840a0a          VSTR     s0,[r4,#0x28]         ;529
0001aa  e758              B        |L2.94|
0001ac  7838              LDRB     r0,[r7,#0]            ;536  ; mode_sw
0001ae  2803              CMP      r0,#3                 ;536
0001b0  d118              BNE      |L2.484|
0001b2  7810              LDRB     r0,[r2,#0]            ;538  ; pow_sw
0001b4  2801              CMP      r0,#1                 ;538
0001b6  d003              BEQ      |L2.448|
0001b8  7838              LDRB     r0,[r7,#0]            ;541  ; mode_sw
0001ba  2803              CMP      r0,#3                 ;541
0001bc  d00d              BEQ      |L2.474|
0001be  e00f              B        |L2.480|
                  |L2.448|
0001c0  edd30a00          VLDR     s1,[r3,#0]            ;540
0001c4  ee201a88          VMUL.F32 s2,s1,s16             ;540
0001c8  eec10a28          VDIV.F32 s1,s2,s17             ;540
0001cc  ed941a0a          VLDR     s2,[r4,#0x28]         ;540
0001d0  ee700a81          VADD.F32 s1,s1,s2              ;540
0001d4  edc40a0a          VSTR     s1,[r4,#0x28]         ;540
0001d8  e004              B        |L2.484|
                  |L2.474|
0001da  7808              LDRB     r0,[r1,#0]            ;541  ; cdc_sw
0001dc  2801              CMP      r0,#1                 ;541
0001de  d00b              BEQ      |L2.504|
                  |L2.480|
0001e0  ed840a0a          VSTR     s0,[r4,#0x28]         ;546
                  |L2.484|
0001e4  7838              LDRB     r0,[r7,#0]            ;550  ; mode_sw
0001e6  2802              CMP      r0,#2                 ;550
0001e8  d190              BNE      |L2.268|
0001ea  f8980000          LDRB     r0,[r8,#0]            ;552  ; load_sw
0001ee  2801              CMP      r0,#1                 ;552
0001f0  d00f              BEQ      |L2.530|
0001f2  ed840a0a          VSTR     s0,[r4,#0x28]         ;556
0001f6  e732              B        |L2.94|
                  |L2.504|
0001f8  edd30a00          VLDR     s1,[r3,#0]            ;543
0001fc  ee600a88          VMUL.F32 s1,s1,s16             ;543
000200  ee801aa8          VDIV.F32 s2,s1,s17             ;543
000204  edd40a0a          VLDR     s1,[r4,#0x28]         ;543
000208  ee710a20          VADD.F32 s1,s2,s1              ;543
00020c  edc40a0a          VSTR     s1,[r4,#0x28]         ;543
000210  e7e8              B        |L2.484|
                  |L2.530|
000212  ed950a00          VLDR     s0,[r5,#0]            ;554
000216  ee200a08          VMUL.F32 s0,s0,s16             ;554
00021a  eec00a28          VDIV.F32 s1,s0,s17             ;554
00021e  ed940a0a          VLDR     s0,[r4,#0x28]         ;554
000222  ee300a80          VADD.F32 s0,s1,s0              ;554
000226  ed840a0a          VSTR     s0,[r4,#0x28]         ;554
00022a  e718              B        |L2.94|
00022c  e7ff              B        |L2.558|
                  |L2.558|
00022e  491e              LDR      r1,|L2.680|
000230  7809              LDRB     r1,[r1,#0]            ;562  ; oct_sw
000232  2901              CMP      r1,#1                 ;562
000234  d191              BNE      |L2.346|
000236  7800              LDRB     r0,[r0,#0]            ;564  ; alert_flag
000238  2801              CMP      r0,#1                 ;564
00023a  d18e              BNE      |L2.346|
00023c  78a0              LDRB     r0,[r4,#2]            ;566  ; calert
00023e  1c40              ADDS     r0,r0,#1              ;566
000240  70a0              STRB     r0,[r4,#2]            ;566
000242  78a0              LDRB     r0,[r4,#2]            ;567  ; calert
000244  2803              CMP      r0,#3                 ;567
000246  d188              BNE      |L2.346|
000248  4918              LDR      r1,|L2.684|
00024a  2001              MOVS     r0,#1                 ;569
00024c  7008              STRB     r0,[r1,#0]            ;569
00024e  70a6              STRB     r6,[r4,#2]            ;570
000250  e705              B        |L2.94|
;;;582    
                          ENDP

000252  0000              DCW      0x0000
                  |L2.596|
                          DCD      0x40000400
                  |L2.600|
                          DCD      page_sw
                  |L2.604|
                          DCD      pow_sw
                  |L2.608|
                          DCD      DISS_POW_Current
                  |L2.612|
                          DCD      DISS_Current
                  |L2.616|
                          DCD      alert_flag
                  |L2.620|
                          DCD      cdc_sw
                  |L2.624|
                          DCD      load_sw
                  |L2.628|
                          DCD      mode_sw
                  |L2.632|
000278  447a0000          DCFS     0x447a0000 ; 1000
                  |L2.636|
00027c  45610000          DCFS     0x45610000 ; 3600
                  |L2.640|
000280  00000000          DCFS     0x00000000 ; 0
                  |L2.644|
                          DCD      ||.data||
                  |L2.648|
                          DCD      second
                  |L2.652|
                          DCD      minute
                  |L2.656|
                          DCD      hour
                  |L2.660|
                          DCD      second1
                  |L2.664|
                          DCD      minute1
                  |L2.668|
                          DCD      hour1
                  |L2.672|
                          DCD      t_onoff
                  |L2.676|
                          DCD      0x40020000
                  |L2.680|
                          DCD      oct_sw
                  |L2.684|
                          DCD      ocstop

                          AREA ||i.TIM3_Int_Init||, CODE, READONLY, ALIGN=2

                  TIM3_Int_Init PROC
;;;412    //?o???¡¦??? 3!
;;;413    void TIM3_Int_Init(u16 arr,u16 psc)
000000  b57f              PUSH     {r0-r6,lr}
;;;414    {
000002  4604              MOV      r4,r0
000004  460d              MOV      r5,r1
;;;415        TIM_TimeBaseInitTypeDef TIM_TimeBaseInitStructure;
;;;416        NVIC_InitTypeDef NVIC_InitStructure;
;;;417        
;;;418        RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM3,ENABLE); //¨´?? TIM3 ??
000006  2101              MOVS     r1,#1
000008  2002              MOVS     r0,#2
00000a  f7fffffe          BL       RCC_APB1PeriphClockCmd
;;;419        TIM_TimeBaseInitStructure.TIM_Period = arr; //??????
00000e  9402              STR      r4,[sp,#8]
;;;420        TIM_TimeBaseInitStructure.TIM_Prescaler=psc; //?????
000010  f8ad5004          STRH     r5,[sp,#4]
;;;421        TIM_TimeBaseInitStructure.TIM_CounterMode=TIM_CounterMode_Up; //§Ó?????
000014  2000              MOVS     r0,#0
000016  f8ad0006          STRH     r0,[sp,#6]
;;;422        TIM_TimeBaseInitStructure.TIM_ClockDivision=TIM_CKD_DIV1;
00001a  f8ad000c          STRH     r0,[sp,#0xc]
;;;423        TIM_TimeBaseInit(TIM3,&TIM_TimeBaseInitStructure);// ¨²?????? TIM3
00001e  4c0e              LDR      r4,|L3.88|
000020  a901              ADD      r1,sp,#4
000022  4620              MOV      r0,r4
000024  f7fffffe          BL       TIM_TimeBaseInit
;;;424        TIM_ITConfig(TIM3,TIM_IT_Update,ENABLE); //?????? 3 ?§ä??
000028  2201              MOVS     r2,#1
00002a  4611              MOV      r1,r2
00002c  4620              MOV      r0,r4
00002e  f7fffffe          BL       TIM_ITConfig
;;;425        NVIC_InitStructure.NVIC_IRQChannel=TIM3_IRQn; //??? 3 ??
000032  211d              MOVS     r1,#0x1d
000034  f88d1000          STRB     r1,[sp,#0]
;;;426        NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority=0x01; //????? 1
000038  2101              MOVS     r1,#1
00003a  f88d1001          STRB     r1,[sp,#1]
;;;427        NVIC_InitStructure.NVIC_IRQChannelSubPriority=0x03; //§¾???? 3
00003e  2203              MOVS     r2,#3
000040  f88d2002          STRB     r2,[sp,#2]
;;;428        NVIC_InitStructure.NVIC_IRQChannelCmd=ENABLE;
000044  f88d1003          STRB     r1,[sp,#3]
;;;429        NVIC_Init(&NVIC_InitStructure);// ¨¹??? NVIC
000048  4668              MOV      r0,sp
00004a  f7fffffe          BL       NVIC_Init
;;;430        TIM_Cmd(TIM3,ENABLE); //Y????? 3
00004e  2101              MOVS     r1,#1
000050  4620              MOV      r0,r4
000052  f7fffffe          BL       TIM_Cmd
;;;431    }
000056  bd7f              POP      {r0-r6,pc}
;;;432    //??? 3 ??????
                          ENDP

                  |L3.88|
                          DCD      0x40000400

                          AREA ||i.TIM4_IRQHandler||, CODE, READONLY, ALIGN=2

                  TIM4_IRQHandler PROC
;;;95     //??? 3 ??????
;;;96     void TIM4_IRQHandler(void)
000000  e92d5ff0          PUSH     {r4-r12,lr}
;;;97     {
000004  ed2d8b06          VPUSH    {d8-d10}
;;;98         static vu16 resetcount;
;;;99         static vu8 read1963;
;;;100        static vu16 scancount;
;;;101        static vu16 uocount;
;;;102        static vu16 powcount;
;;;103        static vu16 powflag;
;;;104        static vu16 finishflag;
;;;105        static float crec1,crec2;
;;;106        u8 crec[6];
;;;107        u8 *csend;
;;;108        static u8 *sendbuf;
;;;109        u8 sendlen;
;;;110        static u16 recrc;
;;;111        static u16 scrc;
;;;112    	static vu8 staticloadflag,staticpowflag;
;;;113        u8 i;
;;;114    //     static float crec1,crec2;
;;;115        
;;;116        if(TIM_GetITStatus(TIM4,TIM_IT_Update)==SET) //????
000008  2101              MOVS     r1,#1
00000a  4cfb              LDR      r4,|L4.1016|
00000c  4620              MOV      r0,r4
00000e  f7fffffe          BL       TIM_GetITStatus
000012  2801              CMP      r0,#1
000014  d17e              BNE      |L4.276|
;;;117        {
;;;118            TIM_ClearITPendingBit(TIM4,TIM_IT_Update); //Çå³ýÖÐ¶Ï±êÖ¾Î»
000016  2101              MOVS     r1,#1
000018  4620              MOV      r0,r4
00001a  f7fffffe          BL       TIM_ClearITPendingBit
;;;119            
;;;120            if(page_sw != face_starter)
00001e  4df7              LDR      r5,|L4.1020|
000020  7828              LDRB     r0,[r5,#0]  ; page_sw
;;;121            {
;;;122                 if(resetflag == 1)
;;;123                 {
;;;124                     if(resetcount == 3000)
000022  2400              MOVS     r4,#0
000024  4ef6              LDR      r6,|L4.1024|
000026  f64038b8          MOV      r8,#0xbb8
00002a  2806              CMP      r0,#6                 ;120
00002c  d031              BEQ      |L4.146|
00002e  78f0              LDRB     r0,[r6,#3]            ;122  ; resetflag
000030  2801              CMP      r0,#1                 ;122
000032  d12e              BNE      |L4.146|
000034  88b0              LDRH     r0,[r6,#4]  ; resetcount
000036  4540              CMP      r0,r8
000038  d128              BNE      |L4.140|
;;;125                     {
;;;126    //                     sLCD_GPIO_Config();
;;;127                         sLCD_Init();
00003a  f7fffffe          BL       sLCD_Init
;;;128    //                     sLCD_WR_REG(0xf1);
;;;129                         GUI_Init();
00003e  f7fffffe          BL       GUI_Init
;;;130                         if(page_sw == face_menu)
000042  7828              LDRB     r0,[r5,#0]  ; page_sw
000044  2802              CMP      r0,#2
000046  d00e              BEQ      |L4.102|
;;;131                         {
;;;132                             ResetPow();
;;;133                         }else if(page_sw == face_cdc){
000048  7828              LDRB     r0,[r5,#0]  ; page_sw
00004a  2801              CMP      r0,#1
00004c  d00e              BEQ      |L4.108|
;;;134                             ResetCDC();
;;;135                         }else if(page_sw == face_r){
00004e  7828              LDRB     r0,[r5,#0]  ; page_sw
000050  2803              CMP      r0,#3
000052  d00e              BEQ      |L4.114|
;;;136                             ResetR();
;;;137                         }else if(page_sw == face_load){
000054  7828              LDRB     r0,[r5,#0]  ; page_sw
000056  2804              CMP      r0,#4
000058  d00e              BEQ      |L4.120|
;;;138                             ResetLoad();
;;;139                         }else if(page_sw == face_graph){
00005a  7828              LDRB     r0,[r5,#0]  ; page_sw
00005c  b178              CBZ      r0,|L4.126|
;;;140                             ResetG();
;;;141                         }else if(page_sw == face_set){
00005e  7828              LDRB     r0,[r5,#0]  ; page_sw
000060  2805              CMP      r0,#5
000062  d00f              BEQ      |L4.132|
000064  e010              B        |L4.136|
                  |L4.102|
000066  f7fffffe          BL       ResetPow
00006a  e00d              B        |L4.136|
                  |L4.108|
00006c  f7fffffe          BL       ResetCDC
000070  e00a              B        |L4.136|
                  |L4.114|
000072  f7fffffe          BL       ResetR
000076  e007              B        |L4.136|
                  |L4.120|
000078  f7fffffe          BL       ResetLoad
00007c  e004              B        |L4.136|
                  |L4.126|
00007e  f7fffffe          BL       ResetG
000082  e001              B        |L4.136|
                  |L4.132|
;;;142                             ResetSET();
000084  f7fffffe          BL       ResetSET
                  |L4.136|
;;;143                         }
;;;144    //                     resdone = 1;
;;;145    //                     resetflag = 0;
;;;146                         resetcount = 0;
000088  80b4              STRH     r4,[r6,#4]
00008a  e002              B        |L4.146|
                  |L4.140|
;;;147                     }else{
;;;148                         resetcount++;
00008c  88b0              LDRH     r0,[r6,#4]  ; resetcount
00008e  1c40              ADDS     r0,r0,#1
000090  80b0              STRH     r0,[r6,#4]
                  |L4.146|
;;;149                     }                
;;;150                 }
;;;151             }
;;;152             if(page_sw == face_r)
000092  7828              LDRB     r0,[r5,#0]  ; page_sw
;;;153    		 {
;;;154    			 if(step == 1)
;;;155    			 {
;;;156    				if(powcount < 6000)
;;;157    				{
;;;158    					SET_Current_Laod = set_static_lc;
;;;159    					flag_Load_CC = 1;
;;;160    					GPIO_ResetBits(GPIOC,GPIO_Pin_10);//CC
;;;161    					GPIO_ResetBits(GPIOA,GPIO_Pin_15);//Ö§Ø“ØºÕ˜On
;;;162    					static_lv = DISS_Voltage;
;;;163    					powcount++;																		
;;;164    				}else{
;;;165    					powcount = 0;
;;;166    					step = 2;
;;;167    					IO_OFF();
;;;168    				}
;;;169    			 }else if(step == 2){
;;;170    				if(powcount < 10000)
;;;171    				{
;;;172    					SET_Voltage = set_static_pv;
;;;173    					SET_Current = set_static_pc;
;;;174    					GPIO_SetBits(GPIOA,GPIO_Pin_15);//Ö§Ø“ØºÕ˜OFF
;;;175    					GPIO_ResetBits(GPIOC,GPIO_Pin_13);//Õ²ßªÖ§Ô´Ë¤Ô¶ÝŒÖ§Ç·
;;;176    					GPIO_SetBits(GPIOC,GPIO_Pin_1);//Õ²ßªÖ§Ô´Ë¤Ô¶
;;;177    					powcount++;
;;;178    					static_pc = DISS_POW_Current;
;;;179    				}else{
;;;180    					step = 3;
;;;181    					powcount = 0;
;;;182    					IO_OFF();			
;;;183    				}
;;;184    			 }else if(step == 3){
;;;185    				if(powcount < 5000)
;;;186    				{
;;;187    					powcount++;
;;;188    				}else{
;;;189    					step = 4;
;;;190    					powcount = 0;	
;;;191    					sendload = 200;				
;;;192    					SET_Current_Laod = set_init_c;
;;;193    					GPIO_ResetBits(GPIOA,GPIO_Pin_15);//æ‰“å¼€è´Ÿè½½
;;;194    				}
;;;195    			 }else if(step == 4){
;;;196    				OC_CHECK();
;;;197    				stepcount ++;
;;;198    				if(stepcount == steptime*10)
;;;199    				{
;;;200    					OC_ADD();
;;;201    					stepcount = 0;
;;;202    				}
;;;203    			 }else if(step == 5){
;;;204    				if(powcount < 1000)
;;;205    				{
;;;206    					SET_Voltage = 3000;
;;;207    					SET_Current = 1000;
;;;208    					GPIO_SetBits(GPIOA,GPIO_Pin_15);//Ö§Ø“ØºÕ˜OFF
;;;209    					GPIO_ResetBits(GPIOC,GPIO_Pin_13);//Õ²ßªÖ§Ô´Ë¤Ô¶ÝŒÖ§Ç·
;;;210    					GPIO_SetBits(GPIOC,GPIO_Pin_1);//Õ²ßªÖ§Ô´Ë¤Ô¶
;;;211    					powcount++;
;;;212    				}else{
;;;213    					step = 6;
;;;214    					powcount = 0;
;;;215    					IO_OFF();
;;;216    				}
;;;217    			 }else if(step == 6){
;;;218    				if(flag_Load_CC == 1)
;;;219    				{
;;;220    					SET_Current_Laod = (int)(oc_data*1000)+8000; 
;;;221    					GPIO_ResetBits(GPIOC,GPIO_Pin_10);//CC
;;;222    					flag_Load_CC = 1;                              
;;;223    					GPIO_ResetBits(GPIOC,GPIO_Pin_10);//CC
;;;224    					GPIO_ResetBits(GPIOA,GPIO_Pin_15);//Ö§Ø“ØºÕ˜On
;;;225    				}else if(flag_Load_CC == 0){
;;;226    					SET_Voltage_Laod = 0;
;;;227    					GPIO_SetBits(GPIOC,GPIO_Pin_10);//CV
;;;228    					flag_Load_CC = 0;
;;;229    					GPIO_ResetBits(GPIOA,GPIO_Pin_15);//Ö§Ø“ØºÕ˜On
;;;230    				}
;;;231    				if(((v - DISS_Voltage) > v*0.6) || (DISS_Current < 0.05))
000094  ed9f9bdb          VLDR     d9,|L4.1028|
000098  ed9faadc          VLDR     s20,|L4.1036|
00009c  f8df9370          LDR      r9,|L4.1040|
0000a0  4ddc              LDR      r5,|L4.1044|
0000a2  4fdd              LDR      r7,|L4.1048|
0000a4  f44f7a7a          MOV      r10,#0x3e8            ;204
0000a8  2803              CMP      r0,#3                 ;152
0000aa  d121              BNE      |L4.240|
0000ac  f8dfb36c          LDR      r11,|L4.1052|
0000b0  f89b0000          LDRB     r0,[r11,#0]           ;154  ; step
0000b4  2801              CMP      r0,#1                 ;154
0000b6  d01c              BEQ      |L4.242|
0000b8  f89b0000          LDRB     r0,[r11,#0]           ;169  ; step
0000bc  2802              CMP      r0,#2                 ;169
0000be  d043              BEQ      |L4.328|
0000c0  f89b0000          LDRB     r0,[r11,#0]           ;184  ; step
0000c4  2803              CMP      r0,#3                 ;184
0000c6  d069              BEQ      |L4.412|
0000c8  f89b0000          LDRB     r0,[r11,#0]           ;195  ; step
0000cc  2804              CMP      r0,#4                 ;195
0000ce  d06e              BEQ      |L4.430|
0000d0  f89b0000          LDRB     r0,[r11,#0]           ;203  ; step
0000d4  2805              CMP      r0,#5                 ;203
0000d6  d06b              BEQ      |L4.432|
0000d8  f89b0000          LDRB     r0,[r11,#0]           ;217  ; step
0000dc  2806              CMP      r0,#6                 ;217
0000de  d068              BEQ      |L4.434|
;;;232    				{
;;;233    					IO_OFF();
;;;234    					step = 7;
;;;235    				}else{
;;;236    					short_time++;                
;;;237    				}
;;;238    			 }else if(step == 7){
0000e0  f89b0000          LDRB     r0,[r11,#0]  ; step
0000e4  2807              CMP      r0,#7
0000e6  d074              BEQ      |L4.466|
;;;239    				 if(powcount < 4000)
;;;240    				{
;;;241    					SET_Voltage =3000;
;;;242    					SET_Current = 1000;
;;;243    					GPIO_ResetBits(GPIOC,GPIO_Pin_13);//Õ²ßªÖ§Ô´Ë¤Ô¶ÝŒÖ§Ç·
;;;244    					GPIO_SetBits(GPIOC,GPIO_Pin_1);//Õ²ßªÖ§Ô´Ë¤Ô¶
;;;245    					powcount++;
;;;246    	//                 shortv = DISS_Voltage;
;;;247    				}else{
;;;248    					powcount = 0;
;;;249    					step = 0;
;;;250    					IO_OFF();                
;;;251    				}
;;;252    			 }else if(step == 0)
0000e8  f89b0000          LDRB     r0,[r11,#0]  ; step
0000ec  2800              CMP      r0,#0
0000ee  d071              BEQ      |L4.468|
                  |L4.240|
0000f0  e128              B        |L4.836|
                  |L4.242|
0000f2  8930              LDRH     r0,[r6,#8]            ;156  ; powcount
0000f4  f2417170          MOV      r1,#0x1770            ;156
0000f8  4288              CMP      r0,r1                 ;156
0000fa  d21e              BCS      |L4.314|
0000fc  f8d500b0          LDR      r0,[r5,#0xb0]         ;158  ; Run_Control
000100  6128              STR      r0,[r5,#0x10]         ;158  ; Run_Control
000102  f8d90000          LDR      r0,[r9,#0]            ;159  ; flagD
000106  f0400080          ORR      r0,r0,#0x80           ;159
00010a  f8c90000          STR      r0,[r9,#0]            ;159  ; flagD
00010e  f44f6180          MOV      r1,#0x400             ;160
000112  e000              B        |L4.278|
                  |L4.276|
000114  e26f              B        |L4.1526|
                  |L4.278|
000116  4638              MOV      r0,r7                 ;160
000118  f7fffffe          BL       GPIO_ResetBits
00011c  f44f4100          MOV      r1,#0x8000            ;161
000120  48bf              LDR      r0,|L4.1056|
000122  f7fffffe          BL       GPIO_ResetBits
000126  48bf              LDR      r0,|L4.1060|
000128  ed900a00          VLDR     s0,[r0,#0]            ;162
00012c  48be              LDR      r0,|L4.1064|
00012e  ed800a00          VSTR     s0,[r0,#0]            ;162
000132  8930              LDRH     r0,[r6,#8]            ;163  ; powcount
000134  1c40              ADDS     r0,r0,#1              ;163
000136  8130              STRH     r0,[r6,#8]            ;163
000138  e104              B        |L4.836|
                  |L4.314|
00013a  8134              STRH     r4,[r6,#8]            ;165
00013c  2002              MOVS     r0,#2                 ;166
00013e  f88b0000          STRB     r0,[r11,#0]           ;166
000142  f7fffffe          BL       IO_OFF
000146  e0fd              B        |L4.836|
                  |L4.328|
000148  8930              LDRH     r0,[r6,#8]            ;170  ; powcount
00014a  f2427110          MOV      r1,#0x2710            ;170
00014e  4288              CMP      r0,r1                 ;170
000150  d21d              BCS      |L4.398|
000152  f8d500a8          LDR      r0,[r5,#0xa8]         ;172  ; Run_Control
000156  6068              STR      r0,[r5,#4]            ;172  ; Run_Control
000158  f8d500ac          LDR      r0,[r5,#0xac]         ;173  ; Run_Control
00015c  60a8              STR      r0,[r5,#8]            ;173  ; Run_Control
00015e  f44f4100          MOV      r1,#0x8000            ;174
000162  48af              LDR      r0,|L4.1056|
000164  f7fffffe          BL       GPIO_SetBits
000168  f44f5100          MOV      r1,#0x2000            ;175
00016c  4638              MOV      r0,r7                 ;175
00016e  f7fffffe          BL       GPIO_ResetBits
000172  2102              MOVS     r1,#2                 ;176
000174  4638              MOV      r0,r7                 ;176
000176  f7fffffe          BL       GPIO_SetBits
00017a  8930              LDRH     r0,[r6,#8]            ;177  ; powcount
00017c  1c40              ADDS     r0,r0,#1              ;177
00017e  8130              STRH     r0,[r6,#8]            ;177
000180  48aa              LDR      r0,|L4.1068|
000182  ed900a00          VLDR     s0,[r0,#0]            ;178
000186  48aa              LDR      r0,|L4.1072|
000188  ed800a00          VSTR     s0,[r0,#0]            ;178
00018c  e0da              B        |L4.836|
                  |L4.398|
00018e  2003              MOVS     r0,#3                 ;180
000190  f88b0000          STRB     r0,[r11,#0]           ;180
000194  8134              STRH     r4,[r6,#8]            ;181
000196  f7fffffe          BL       IO_OFF
00019a  e0d3              B        |L4.836|
                  |L4.412|
00019c  8931              LDRH     r1,[r6,#8]            ;185  ; powcount
00019e  f2413088          MOV      r0,#0x1388            ;185
0001a2  4281              CMP      r1,r0                 ;185
0001a4  d206              BCS      |L4.436|
0001a6  8930              LDRH     r0,[r6,#8]            ;187  ; powcount
0001a8  1c40              ADDS     r0,r0,#1              ;187
0001aa  8130              STRH     r0,[r6,#8]            ;187
0001ac  e0ca              B        |L4.836|
                  |L4.430|
0001ae  e012              B        |L4.470|
                  |L4.432|
0001b0  e028              B        |L4.516|
                  |L4.434|
0001b2  e047              B        |L4.580|
                  |L4.436|
0001b4  2004              MOVS     r0,#4                 ;189
0001b6  f88b0000          STRB     r0,[r11,#0]           ;189
0001ba  8134              STRH     r4,[r6,#8]            ;190
0001bc  499d              LDR      r1,|L4.1076|
0001be  20c8              MOVS     r0,#0xc8              ;191
0001c0  8008              STRH     r0,[r1,#0]            ;191
0001c2  6da8              LDR      r0,[r5,#0x58]         ;192  ; Run_Control
0001c4  6128              STR      r0,[r5,#0x10]         ;192  ; Run_Control
0001c6  f44f4100          MOV      r1,#0x8000            ;193
0001ca  4895              LDR      r0,|L4.1056|
0001cc  f7fffffe          BL       GPIO_ResetBits
0001d0  e0b8              B        |L4.836|
                  |L4.466|
0001d2  e099              B        |L4.776|
                  |L4.468|
0001d4  e0b3              B        |L4.830|
                  |L4.470|
0001d6  f7fffffe          BL       OC_CHECK
0001da  f8dfb25c          LDR      r11,|L4.1080|
0001de  f8bb0000          LDRH     r0,[r11,#0]           ;197  ; stepcount
0001e2  1c40              ADDS     r0,r0,#1              ;197
0001e4  f8ab0000          STRH     r0,[r11,#0]           ;197
0001e8  4894              LDR      r0,|L4.1084|
0001ea  8800              LDRH     r0,[r0,#0]            ;198  ; steptime
0001ec  f8bb1000          LDRH     r1,[r11,#0]           ;198  ; stepcount
0001f0  eb000080          ADD      r0,r0,r0,LSL #2       ;198
0001f4  ebb10f40          CMP      r1,r0,LSL #1          ;198
0001f8  d103              BNE      |L4.514|
0001fa  f7fffffe          BL       OC_ADD
0001fe  f8ab4000          STRH     r4,[r11,#0]           ;201
                  |L4.514|
000202  e09f              B        |L4.836|
                  |L4.516|
000204  8930              LDRH     r0,[r6,#8]            ;204  ; powcount
000206  4550              CMP      r0,r10                ;204
000208  d215              BCS      |L4.566|
00020a  f8c58004          STR      r8,[r5,#4]            ;206  ; Run_Control
00020e  f8c5a008          STR      r10,[r5,#8]           ;207  ; Run_Control
000212  f44f4100          MOV      r1,#0x8000            ;208
000216  4882              LDR      r0,|L4.1056|
000218  f7fffffe          BL       GPIO_SetBits
00021c  f44f5100          MOV      r1,#0x2000            ;209
000220  4638              MOV      r0,r7                 ;209
000222  f7fffffe          BL       GPIO_ResetBits
000226  2102              MOVS     r1,#2                 ;210
000228  4638              MOV      r0,r7                 ;210
00022a  f7fffffe          BL       GPIO_SetBits
00022e  8930              LDRH     r0,[r6,#8]            ;211  ; powcount
000230  1c40              ADDS     r0,r0,#1              ;211
000232  8130              STRH     r0,[r6,#8]            ;211
000234  e086              B        |L4.836|
                  |L4.566|
000236  2006              MOVS     r0,#6                 ;213
000238  f88b0000          STRB     r0,[r11,#0]           ;213
00023c  8134              STRH     r4,[r6,#8]            ;214
00023e  f7fffffe          BL       IO_OFF
000242  e07f              B        |L4.836|
                  |L4.580|
000244  f8990000          LDRB     r0,[r9,#0]            ;218  ; flagD
000248  0600              LSLS     r0,r0,#24             ;218
00024a  d521              BPL      |L4.656|
00024c  487c              LDR      r0,|L4.1088|
00024e  ed900a00          VLDR     s0,[r0,#0]            ;220
000252  ee200a0a          VMUL.F32 s0,s0,s20             ;220
000256  eebd0ac0          VCVT.S32.F32 s0,s0                 ;220
00025a  ee100a10          VMOV     r0,s0                 ;220
00025e  f50050fa          ADD      r0,r0,#0x1f40         ;220
000262  6128              STR      r0,[r5,#0x10]         ;220  ; Run_Control
000264  f44f6180          MOV      r1,#0x400             ;221
000268  4638              MOV      r0,r7                 ;221
00026a  f7fffffe          BL       GPIO_ResetBits
00026e  f8d90000          LDR      r0,[r9,#0]            ;222  ; flagD
000272  f0400080          ORR      r0,r0,#0x80           ;222
000276  f8c90000          STR      r0,[r9,#0]            ;222  ; flagD
00027a  f44f6180          MOV      r1,#0x400             ;223
00027e  4638              MOV      r0,r7                 ;223
000280  f7fffffe          BL       GPIO_ResetBits
000284  f44f4100          MOV      r1,#0x8000            ;224
000288  4865              LDR      r0,|L4.1056|
00028a  f7fffffe          BL       GPIO_ResetBits
00028e  e010              B        |L4.690|
                  |L4.656|
000290  60ec              STR      r4,[r5,#0xc]          ;226  ; Run_Control
000292  f44f6180          MOV      r1,#0x400             ;227
000296  4638              MOV      r0,r7                 ;227
000298  f7fffffe          BL       GPIO_SetBits
00029c  f8d90000          LDR      r0,[r9,#0]            ;228  ; flagD
0002a0  f0200080          BIC      r0,r0,#0x80           ;228
0002a4  f8c90000          STR      r0,[r9,#0]            ;228  ; flagD
0002a8  f44f4100          MOV      r1,#0x8000            ;229
0002ac  485c              LDR      r0,|L4.1056|
0002ae  f7fffffe          BL       GPIO_ResetBits
                  |L4.690|
0002b2  4864              LDR      r0,|L4.1092|
0002b4  edd0aa00          VLDR     s21,[r0,#0]           ;231
0002b8  ee1a0a90          VMOV     r0,s21                ;231
0002bc  f7fffffe          BL       __aeabi_f2d
0002c0  ec532b19          VMOV     r2,r3,d9              ;231
0002c4  f7fffffe          BL       __aeabi_dmul
0002c8  ec410b18          VMOV     d8,r0,r1              ;231
0002cc  4855              LDR      r0,|L4.1060|
0002ce  ed900a00          VLDR     s0,[r0,#0]            ;231
0002d2  ee3a0ac0          VSUB.F32 s0,s21,s0             ;231
0002d6  ee100a10          VMOV     r0,s0                 ;231
0002da  f7fffffe          BL       __aeabi_f2d
0002de  ec532b18          VMOV     r2,r3,d8              ;231
0002e2  f7fffffe          BL       __aeabi_cdrcmple
0002e6  d304              BCC      |L4.754|
0002e8  4857              LDR      r0,|L4.1096|
0002ea  6800              LDR      r0,[r0,#0]            ;231  ; DISS_Current
0002ec  4957              LDR      r1,|L4.1100|
0002ee  4288              CMP      r0,r1                 ;231
0002f0  da05              BGE      |L4.766|
                  |L4.754|
0002f2  f7fffffe          BL       IO_OFF
0002f6  2007              MOVS     r0,#7                 ;234
0002f8  f88b0000          STRB     r0,[r11,#0]           ;234
0002fc  e022              B        |L4.836|
                  |L4.766|
0002fe  4854              LDR      r0,|L4.1104|
000300  8801              LDRH     r1,[r0,#0]            ;236  ; short_time
000302  1c49              ADDS     r1,r1,#1              ;236
000304  8001              STRH     r1,[r0,#0]            ;236
000306  e01d              B        |L4.836|
                  |L4.776|
000308  8930              LDRH     r0,[r6,#8]            ;239  ; powcount
00030a  f5b06f7a          CMP      r0,#0xfa0             ;239
00030e  d210              BCS      |L4.818|
000310  f8c58004          STR      r8,[r5,#4]            ;241  ; Run_Control
000314  f8c5a008          STR      r10,[r5,#8]           ;242  ; Run_Control
000318  f44f5100          MOV      r1,#0x2000            ;243
00031c  4638              MOV      r0,r7                 ;243
00031e  f7fffffe          BL       GPIO_ResetBits
000322  2102              MOVS     r1,#2                 ;244
000324  4638              MOV      r0,r7                 ;244
000326  f7fffffe          BL       GPIO_SetBits
00032a  8930              LDRH     r0,[r6,#8]            ;245  ; powcount
00032c  1c40              ADDS     r0,r0,#1              ;245
00032e  8130              STRH     r0,[r6,#8]            ;245
000330  e008              B        |L4.836|
                  |L4.818|
000332  8134              STRH     r4,[r6,#8]            ;248
000334  f88b4000          STRB     r4,[r11,#0]           ;249
000338  f7fffffe          BL       IO_OFF
00033c  e002              B        |L4.836|
                  |L4.830|
;;;253    			 {
;;;254    				 powcount = 0;
00033e  8134              STRH     r4,[r6,#8]
;;;255    				 IO_OFF();
000340  f7fffffe          BL       IO_OFF
                  |L4.836|
;;;256    			 }
;;;257    		}
;;;258            
;;;259    		
;;;260            if(usartocflag == 1)
000344  7830              LDRB     r0,[r6,#0]  ; usartocflag
000346  f04f0b01          MOV      r11,#1                ;116
00034a  2801              CMP      r0,#1
00034c  d153              BNE      |L4.1014|
;;;261            {
;;;262    
;;;263                if(flag_Load_CC == 1)
00034e  f8990000          LDRB     r0,[r9,#0]  ; flagD
000352  0600              LSLS     r0,r0,#24
000354  d50a              BPL      |L4.876|
;;;264                {              
;;;265                    GPIO_ResetBits(GPIOC,GPIO_Pin_10);//CC
000356  f44f6180          MOV      r1,#0x400
00035a  4638              MOV      r0,r7
00035c  f7fffffe          BL       GPIO_ResetBits
;;;266                    GPIO_ResetBits(GPIOA,GPIO_Pin_15);//µç×Ó¸ºÔØOn
000360  f44f4100          MOV      r1,#0x8000
000364  482e              LDR      r0,|L4.1056|
000366  f7fffffe          BL       GPIO_ResetBits
00036a  e010              B        |L4.910|
                  |L4.876|
;;;267                }else if(flag_Load_CC == 0){
;;;268                    SET_Voltage_Laod = 0;
00036c  60ec              STR      r4,[r5,#0xc]  ; Run_Control
;;;269                    GPIO_SetBits(GPIOC,GPIO_Pin_10);//CV
00036e  f44f6180          MOV      r1,#0x400
000372  4638              MOV      r0,r7
000374  f7fffffe          BL       GPIO_SetBits
;;;270                    flag_Load_CC = 0;
000378  f8d90000          LDR      r0,[r9,#0]  ; flagD
00037c  f0200080          BIC      r0,r0,#0x80
000380  f8c90000          STR      r0,[r9,#0]  ; flagD
;;;271                    GPIO_ResetBits(GPIOA,GPIO_Pin_15);//µç×Ó¸ºÔØOn
000384  f44f4100          MOV      r1,#0x8000
000388  4825              LDR      r0,|L4.1056|
00038a  f7fffffe          BL       GPIO_ResetBits
                  |L4.910|
;;;272                }
;;;273                crec2 = crec1;
00038e  ed960a05          VLDR     s0,[r6,#0x14]
000392  ed860a06          VSTR     s0,[r6,#0x18]
;;;274                crec1 = DISS_Current;
000396  482c              LDR      r0,|L4.1096|
000398  edd00a00          VLDR     s1,[r0,#0]
00039c  edc60a05          VSTR     s1,[r6,#0x14]
;;;275                if(crec1 < crec2 && crec2 > 0.3)
0003a0  eef40ac0          VCMPE.F32 s1,s0
0003a4  eef1fa10          VMRS     APSR_nzcv,FPSCR
0003a8  d25c              BCS      |L4.1124|
0003aa  ee100a10          VMOV     r0,s0
0003ae  4929              LDR      r1,|L4.1108|
0003b0  4288              CMP      r0,r1
0003b2  db57              BLT      |L4.1124|
;;;276                {     
;;;277                    oc_data = crec2;
0003b4  4822              LDR      r0,|L4.1088|
0003b6  ed800a00          VSTR     s0,[r0,#0]
;;;278                    g_tModS.TxBuf[13] = (int)(oc_data*1000)>>8;
0003ba  ee200a0a          VMUL.F32 s0,s0,s20
0003be  eebd0ac0          VCVT.S32.F32 s0,s0
0003c2  ee100a10          VMOV     r0,s0
0003c6  0a01              LSRS     r1,r0,#8
0003c8  4823              LDR      r0,|L4.1112|
0003ca  7001              STRB     r1,[r0,#0]
;;;279                    g_tModS.TxBuf[14] = (int)(oc_data*1000);
0003cc  ee101a10          VMOV     r1,s0
0003d0  7041              STRB     r1,[r0,#1]
;;;280                    SET_Current_Laod = set_init_c;
0003d2  6da8              LDR      r0,[r5,#0x58]  ; Run_Control
0003d4  6128              STR      r0,[r5,#0x10]  ; Run_Control
;;;281                    GPIO_SetBits(GPIOA,GPIO_Pin_15);//å…³é—­è´Ÿè½½ 
0003d6  f44f4100          MOV      r1,#0x8000
0003da  4811              LDR      r0,|L4.1056|
0003dc  f7fffffe          BL       GPIO_SetBits
;;;282    //                MODS_SendWithCRC(g_tModS.TxBuf, g_tModS.TxCount);
;;;283                    t_onoff = 0;
0003e0  481e              LDR      r0,|L4.1116|
0003e2  7004              STRB     r4,[r0,#0]
;;;284                    usartocflag = 0;
0003e4  7034              STRB     r4,[r6,#0]
;;;285                    crec1 = 0;
0003e6  ed9f0a1e          VLDR     s0,|L4.1120|
0003ea  ed860a05          VSTR     s0,[r6,#0x14]
;;;286                    crec2 = 0;
0003ee  ed860a06          VSTR     s0,[r6,#0x18]
;;;287                    powflag = 1;
0003f2  f8a6b00a          STRH     r11,[r6,#0xa]
                  |L4.1014|
0003f6  e03f              B        |L4.1144|
                  |L4.1016|
                          DCD      0x40000800
                  |L4.1020|
                          DCD      page_sw
                  |L4.1024|
                          DCD      ||.data||
                  |L4.1028|
000404  33333333          DCFD     0x3fe3333333333333 ; 0.59999999999999998
000408  3fe33333
                  |L4.1036|
00040c  447a0000          DCFS     0x447a0000 ; 1000
                  |L4.1040|
                          DCD      flagD
                  |L4.1044|
                          DCD      Run_Control
                  |L4.1048|
                          DCD      0x40020800
                  |L4.1052|
                          DCD      step
                  |L4.1056|
                          DCD      0x40020000
                  |L4.1060|
                          DCD      DISS_Voltage
                  |L4.1064|
                          DCD      static_lv
                  |L4.1068|
                          DCD      DISS_POW_Current
                  |L4.1072|
                          DCD      static_pc
                  |L4.1076|
                          DCD      sendload
                  |L4.1080|
                          DCD      stepcount
                  |L4.1084|
                          DCD      steptime
                  |L4.1088|
                          DCD      oc_data
                  |L4.1092|
                          DCD      v
                  |L4.1096|
                          DCD      DISS_Current
                  |L4.1100|
                          DCD      0x3d4ccccd
                  |L4.1104|
                          DCD      short_time
                  |L4.1108|
                          DCD      0x3e99999a
                  |L4.1112|
                          DCD      g_tModS+0x2b
                  |L4.1116|
                          DCD      t_onoff
                  |L4.1120|
000460  00000000          DCFS     0x00000000 ; 0
                  |L4.1124|
;;;288                    
;;;289                }else{
;;;290                    if(flag_Load_CC == 1)
000464  f8990000          LDRB     r0,[r9,#0]  ; flagD
000468  0600              LSLS     r0,r0,#24
00046a  d505              BPL      |L4.1144|
;;;291                    {
;;;292                        if(uocount == 10)
00046c  88f0              LDRH     r0,[r6,#6]  ; uocount
00046e  280a              CMP      r0,#0xa
000470  d006              BEQ      |L4.1152|
;;;293                        {
;;;294                            SET_Current_Laod = SET_Current_Laod + 10;
;;;295                            uocount = 0;
;;;296                        }else{
;;;297                            uocount++;
000472  88f0              LDRH     r0,[r6,#6]  ; uocount
000474  1c40              ADDS     r0,r0,#1
000476  80f0              STRH     r0,[r6,#6]
                  |L4.1144|
;;;298                        }
;;;299                    }                    
;;;300                }
;;;301            }
;;;302            if(powflag == 1)
000478  8970              LDRH     r0,[r6,#0xa]  ; powflag
00047a  2801              CMP      r0,#1
00047c  d005              BEQ      |L4.1162|
00047e  e02a              B        |L4.1238|
                  |L4.1152|
000480  6928              LDR      r0,[r5,#0x10]         ;294  ; Run_Control
000482  300a              ADDS     r0,r0,#0xa            ;294
000484  6128              STR      r0,[r5,#0x10]         ;294  ; Run_Control
000486  80f4              STRH     r4,[r6,#6]            ;295
000488  e7f6              B        |L4.1144|
                  |L4.1162|
;;;303            {
;;;304                if(powcount < 1000)
00048a  8930              LDRH     r0,[r6,#8]  ; powcount
00048c  4550              CMP      r0,r10
00048e  d215              BCS      |L4.1212|
;;;305                {
;;;306                    SET_Voltage =3000;
000490  f8c58004          STR      r8,[r5,#4]  ; Run_Control
;;;307                    SET_Current = 1000;
000494  f8c5a008          STR      r10,[r5,#8]  ; Run_Control
;;;308                    GPIO_SetBits(GPIOA,GPIO_Pin_15);//µç×Ó¸ºÔØOFF
000498  f44f4100          MOV      r1,#0x8000
00049c  485d              LDR      r0,|L4.1556|
00049e  f7fffffe          BL       GPIO_SetBits
;;;309                    GPIO_ResetBits(GPIOC,GPIO_Pin_13);//´ò¿ªµçÔ´Êä³ö¼ÌµçÆ÷
0004a2  f44f5100          MOV      r1,#0x2000
0004a6  4638              MOV      r0,r7
0004a8  f7fffffe          BL       GPIO_ResetBits
;;;310                    GPIO_SetBits(GPIOC,GPIO_Pin_1);//´ò¿ªµçÔ´Êä³ö
0004ac  2102              MOVS     r1,#2
0004ae  4638              MOV      r0,r7
0004b0  f7fffffe          BL       GPIO_SetBits
;;;311                    powcount++;
0004b4  8930              LDRH     r0,[r6,#8]  ; powcount
0004b6  1c40              ADDS     r0,r0,#1
0004b8  8130              STRH     r0,[r6,#8]
0004ba  e00c              B        |L4.1238|
                  |L4.1212|
;;;312    //                 shortv = DISS_Voltage;
;;;313                }else{
;;;314                    powcount = 0;
0004bc  8134              STRH     r4,[r6,#8]
;;;315                    powflag = 0;
0004be  8174              STRH     r4,[r6,#0xa]
;;;316                    GPIO_ResetBits(GPIOC,GPIO_Pin_1);//¹Ø±ÕµçÔ´Êä³ö
0004c0  2102              MOVS     r1,#2
0004c2  4638              MOV      r0,r7
0004c4  f7fffffe          BL       GPIO_ResetBits
;;;317                    GPIO_SetBits(GPIOC,GPIO_Pin_13);//¹Ø±ÕµçÔ´Êä³ö¼ÌµçÆ÷ 
0004c8  f44f5100          MOV      r1,#0x2000
0004cc  4638              MOV      r0,r7
0004ce  f7fffffe          BL       GPIO_SetBits
;;;318                    usartshortflag = 1;
0004d2  f886b001          STRB     r11,[r6,#1]
                  |L4.1238|
;;;319                    
;;;320                }
;;;321            }
;;;322            if(usartshortflag == 1)
0004d6  7870              LDRB     r0,[r6,#1]  ; usartshortflag
0004d8  2801              CMP      r0,#1
0004da  d176              BNE      |L4.1482|
;;;323            {
;;;324                if(flag_Load_CC == 1)
0004dc  f8990000          LDRB     r0,[r9,#0]  ; flagD
0004e0  0600              LSLS     r0,r0,#24
0004e2  d522              BPL      |L4.1322|
;;;325                {
;;;326                    SET_Current_Laod = (int)(oc_data*1000)+5000; 
0004e4  484c              LDR      r0,|L4.1560|
0004e6  f2413188          MOV      r1,#0x1388
0004ea  ed900a00          VLDR     s0,[r0,#0]
0004ee  ee200a0a          VMUL.F32 s0,s0,s20
0004f2  eebd0ac0          VCVT.S32.F32 s0,s0
0004f6  ee100a10          VMOV     r0,s0
0004fa  4408              ADD      r0,r0,r1
0004fc  6128              STR      r0,[r5,#0x10]  ; Run_Control
;;;327                    GPIO_ResetBits(GPIOC,GPIO_Pin_10);//CC
0004fe  f44f6180          MOV      r1,#0x400
000502  4638              MOV      r0,r7
000504  f7fffffe          BL       GPIO_ResetBits
;;;328                    flag_Load_CC = 1;                              
000508  f8d90000          LDR      r0,[r9,#0]  ; flagD
00050c  f0400080          ORR      r0,r0,#0x80
000510  f8c90000          STR      r0,[r9,#0]  ; flagD
;;;329                    GPIO_ResetBits(GPIOC,GPIO_Pin_10);//CC
000514  f44f6180          MOV      r1,#0x400
000518  4638              MOV      r0,r7
00051a  f7fffffe          BL       GPIO_ResetBits
;;;330                    GPIO_ResetBits(GPIOA,GPIO_Pin_15);//µç×Ó¸ºÔØOn
00051e  f44f4100          MOV      r1,#0x8000
000522  483c              LDR      r0,|L4.1556|
000524  f7fffffe          BL       GPIO_ResetBits
000528  e010              B        |L4.1356|
                  |L4.1322|
;;;331                }else if(flag_Load_CC == 0){
;;;332                    SET_Voltage_Laod = 0;
00052a  60ec              STR      r4,[r5,#0xc]  ; Run_Control
;;;333                    GPIO_SetBits(GPIOC,GPIO_Pin_10);//CV
00052c  f44f6180          MOV      r1,#0x400
000530  4638              MOV      r0,r7
000532  f7fffffe          BL       GPIO_SetBits
;;;334                    flag_Load_CC = 0;
000536  f8d90000          LDR      r0,[r9,#0]  ; flagD
00053a  f0200080          BIC      r0,r0,#0x80
00053e  f8c90000          STR      r0,[r9,#0]  ; flagD
;;;335                    GPIO_ResetBits(GPIOA,GPIO_Pin_15);//µç×Ó¸ºÔØOn
000542  f44f4100          MOV      r1,#0x8000
000546  4833              LDR      r0,|L4.1556|
000548  f7fffffe          BL       GPIO_ResetBits
                  |L4.1356|
;;;336                }
;;;337                if(((shortv - DISS_Voltage) > shortv*0.6) || (DISS_Current < 0.05))
00054c  ed96aa0e          VLDR     s20,[r6,#0x38]
000550  ee1a0a10          VMOV     r0,s20
000554  f7fffffe          BL       __aeabi_f2d
000558  ec532b19          VMOV     r2,r3,d9
00055c  f7fffffe          BL       __aeabi_dmul
000560  ec410b18          VMOV     d8,r0,r1
000564  482d              LDR      r0,|L4.1564|
000566  ed900a00          VLDR     s0,[r0,#0]
00056a  ee3a0a40          VSUB.F32 s0,s20,s0
00056e  ee100a10          VMOV     r0,s0
000572  f7fffffe          BL       __aeabi_f2d
000576  ec532b18          VMOV     r2,r3,d8
00057a  f7fffffe          BL       __aeabi_cdrcmple
00057e  d304              BCC      |L4.1418|
000580  4827              LDR      r0,|L4.1568|
000582  6800              LDR      r0,[r0,#0]  ; DISS_Current
000584  4927              LDR      r1,|L4.1572|
000586  4288              CMP      r0,r1
000588  da1b              BGE      |L4.1474|
                  |L4.1418|
;;;338                {
;;;339                    IO_OFF();
00058a  f7fffffe          BL       IO_OFF
;;;340                    usartshortflag = 0;               
00058e  7074              STRB     r4,[r6,#1]
;;;341                    g_tModS.TxBuf[17] = (short_time/10)>>8;
000590  f8df9094          LDR      r9,|L4.1576|
000594  f8b90000          LDRH     r0,[r9,#0]  ; short_time
000598  210a              MOVS     r1,#0xa
00059a  fbb0f0f1          UDIV     r0,r0,r1
00059e  0a02              LSRS     r2,r0,#8
0005a0  4822              LDR      r0,|L4.1580|
0005a2  7002              STRB     r2,[r0,#0]
;;;342                    g_tModS.TxBuf[18] = (short_time/10);
0005a4  f8b92000          LDRH     r2,[r9,#0]  ; short_time
0005a8  fbb2f1f1          UDIV     r1,r2,r1
0005ac  7041              STRB     r1,[r0,#1]
;;;343                    MODS_SendWithCRC(g_tModS.TxBuf, g_tModS.TxCount);
0005ae  f8901073          LDRB     r1,[r0,#0x73]  ; g_tModS
0005b2  3811              SUBS     r0,r0,#0x11
0005b4  f7fffffe          BL       MODS_SendWithCRC
;;;344                    finishflag=1;
0005b8  f8a6b00c          STRH     r11,[r6,#0xc]
;;;345                    short_time = 0;
0005bc  f8a94000          STRH     r4,[r9,#0]
0005c0  e003              B        |L4.1482|
                  |L4.1474|
;;;346                }else{
;;;347                    short_time++;                
0005c2  4819              LDR      r0,|L4.1576|
0005c4  8801              LDRH     r1,[r0,#0]  ; short_time
0005c6  1c49              ADDS     r1,r1,#1
0005c8  8001              STRH     r1,[r0,#0]
                  |L4.1482|
;;;348                }
;;;349            }
;;;350            if(finishflag == 1)
0005ca  89b0              LDRH     r0,[r6,#0xc]  ; finishflag
0005cc  2801              CMP      r0,#1
0005ce  d112              BNE      |L4.1526|
;;;351            {
;;;352                if(powcount < 1000)
0005d0  8930              LDRH     r0,[r6,#8]  ; powcount
0005d2  4550              CMP      r0,r10
0005d4  d213              BCS      |L4.1534|
;;;353                {
;;;354                    SET_Voltage =3000;
0005d6  f8c58004          STR      r8,[r5,#4]  ; Run_Control
;;;355                    SET_Current = 1000;
0005da  f8c5a008          STR      r10,[r5,#8]  ; Run_Control
;;;356                    GPIO_ResetBits(GPIOC,GPIO_Pin_13);//´ò¿ªµçÔ´Êä³ö¼ÌµçÆ÷
0005de  f44f5100          MOV      r1,#0x2000
0005e2  4638              MOV      r0,r7
0005e4  f7fffffe          BL       GPIO_ResetBits
;;;357                    GPIO_SetBits(GPIOC,GPIO_Pin_1);//´ò¿ªµçÔ´Êä³ö
0005e8  2102              MOVS     r1,#2
0005ea  4638              MOV      r0,r7
0005ec  f7fffffe          BL       GPIO_SetBits
;;;358                    powcount++;
0005f0  8930              LDRH     r0,[r6,#8]  ; powcount
0005f2  1c40              ADDS     r0,r0,#1
0005f4  8130              STRH     r0,[r6,#8]
                  |L4.1526|
;;;359    //                 shortv = DISS_Voltage;
;;;360                }else{
;;;361                    SET_Current_Laod = 1000;
;;;362                    powcount = 0;
;;;363                    finishflag = 0;
;;;364                    IO_OFF();                
;;;365                }
;;;366            }
;;;367        }    
;;;368    }
0005f6  ecbd8b06          VPOP     {d8-d10}
0005fa  e8bd9ff0          POP      {r4-r12,pc}
                  |L4.1534|
0005fe  f8c5a010          STR      r10,[r5,#0x10]        ;361  ; Run_Control
000602  8134              STRH     r4,[r6,#8]            ;362
000604  81b4              STRH     r4,[r6,#0xc]          ;363
000606  ecbd8b06          VPOP     {d8-d10}              ;364
00060a  e8bd5ff0          POP      {r4-r12,lr}           ;364
00060e  f7ffbffe          B.W      IO_OFF
;;;369    
                          ENDP

000612  0000              DCW      0x0000
                  |L4.1556|
                          DCD      0x40020000
                  |L4.1560|
                          DCD      oc_data
                  |L4.1564|
                          DCD      DISS_Voltage
                  |L4.1568|
                          DCD      DISS_Current
                  |L4.1572|
                          DCD      0x3d4ccccd
                  |L4.1576|
                          DCD      short_time
                  |L4.1580|
                          DCD      g_tModS+0x2f

                          AREA ||i.TIM4_Int_Init||, CODE, READONLY, ALIGN=2

                  TIM4_Int_Init PROC
;;;75     //?o???¡¦??? 3!
;;;76     void TIM4_Int_Init(u16 arr,u16 psc)
000000  b57f              PUSH     {r0-r6,lr}
;;;77     {
000002  4604              MOV      r4,r0
000004  460d              MOV      r5,r1
;;;78         TIM_TimeBaseInitTypeDef TIM_TimeBaseInitStructure;
;;;79         NVIC_InitTypeDef NVIC_InitStructure;
;;;80         
;;;81         RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM4,ENABLE); //¨´?? TIM3 ??
000006  2101              MOVS     r1,#1
000008  2004              MOVS     r0,#4
00000a  f7fffffe          BL       RCC_APB1PeriphClockCmd
;;;82         TIM_TimeBaseInitStructure.TIM_Period = arr; //??????
00000e  9402              STR      r4,[sp,#8]
;;;83         TIM_TimeBaseInitStructure.TIM_Prescaler=psc; //?????
000010  f8ad5004          STRH     r5,[sp,#4]
;;;84         TIM_TimeBaseInitStructure.TIM_CounterMode=TIM_CounterMode_Up; //§Ó?????
000014  2000              MOVS     r0,#0
000016  f8ad0006          STRH     r0,[sp,#6]
;;;85         TIM_TimeBaseInitStructure.TIM_ClockDivision=TIM_CKD_DIV1;
00001a  f8ad000c          STRH     r0,[sp,#0xc]
;;;86         TIM_TimeBaseInit(TIM4,&TIM_TimeBaseInitStructure);// ¨²?????? TIM3
00001e  4c0e              LDR      r4,|L5.88|
000020  a901              ADD      r1,sp,#4
000022  4620              MOV      r0,r4
000024  f7fffffe          BL       TIM_TimeBaseInit
;;;87         TIM_ITConfig(TIM4,TIM_IT_Update,ENABLE); //?????? 3 ?§ä??
000028  2201              MOVS     r2,#1
00002a  4611              MOV      r1,r2
00002c  4620              MOV      r0,r4
00002e  f7fffffe          BL       TIM_ITConfig
;;;88         NVIC_InitStructure.NVIC_IRQChannel=TIM4_IRQn; //??? 3 ??
000032  211e              MOVS     r1,#0x1e
000034  f88d1000          STRB     r1,[sp,#0]
;;;89         NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority=0x01; //????? 1
000038  2101              MOVS     r1,#1
00003a  f88d1001          STRB     r1,[sp,#1]
;;;90         NVIC_InitStructure.NVIC_IRQChannelSubPriority=0x03; //§¾???? 3
00003e  2203              MOVS     r2,#3
000040  f88d2002          STRB     r2,[sp,#2]
;;;91         NVIC_InitStructure.NVIC_IRQChannelCmd=ENABLE;
000044  f88d1003          STRB     r1,[sp,#3]
;;;92         NVIC_Init(&NVIC_InitStructure);// ¨¹??? NVIC
000048  4668              MOV      r0,sp
00004a  f7fffffe          BL       NVIC_Init
;;;93         TIM_Cmd(TIM4,ENABLE); //Y????? 3
00004e  2101              MOVS     r1,#1
000050  4620              MOV      r0,r4
000052  f7fffffe          BL       TIM_Cmd
;;;94     }
000056  bd7f              POP      {r0-r6,pc}
;;;95     //??? 3 ??????
                          ENDP

                  |L5.88|
                          DCD      0x40000800

                          AREA ||i.TIM5_IRQHandler||, CODE, READONLY, ALIGN=2

                  TIM5_IRQHandler PROC
;;;603    
;;;604    void TIM5_IRQHandler(void)
000000  b510              PUSH     {r4,lr}
;;;605    {
;;;606        
;;;607        if(TIM_GetITStatus(TIM5,TIM_IT_Update)==SET) //Ó§Ô¶××
000002  4c0a              LDR      r4,|L6.44|
000004  2101              MOVS     r1,#1
000006  4620              MOV      r0,r4
000008  f7fffffe          BL       TIM_GetITStatus
00000c  2801              CMP      r0,#1
00000e  d10b              BNE      |L6.40|
;;;608        {
;;;609            TIM_ClearITPendingBit(TIM5,TIM_IT_Update); //æ¸…é™¤ä¸­æ–­æ ‡å¿—ä½?
000010  2101              MOVS     r1,#1
000012  4620              MOV      r0,r4
000014  f7fffffe          BL       TIM_ClearITPendingBit
;;;610            Tick_10ms ++;
000018  4805              LDR      r0,|L6.48|
00001a  6901              LDR      r1,[r0,#0x10]  ; Tick_10ms
00001c  1c49              ADDS     r1,r1,#1
00001e  6101              STR      r1,[r0,#0x10]  ; Tick_10ms
;;;611            MODS_Poll();
000020  e8bd4010          POP      {r4,lr}
000024  f7ffbffe          B.W      MODS_Poll
                  |L6.40|
;;;612        }
;;;613    }
000028  bd10              POP      {r4,pc}
;;;614    
                          ENDP

00002a  0000              DCW      0x0000
                  |L6.44|
                          DCD      0x40000c00
                  |L6.48|
                          DCD      ||.data||

                          AREA ||i.TIM5_Int_Init||, CODE, READONLY, ALIGN=2

                  TIM5_Int_Init PROC
;;;582    
;;;583    void TIM5_Int_Init(u16 arr,u16 psc)
000000  b57f              PUSH     {r0-r6,lr}
;;;584    {
000002  4604              MOV      r4,r0
000004  460d              MOV      r5,r1
;;;585        TIM_TimeBaseInitTypeDef TIM_TimeBaseInitStructure;
;;;586        NVIC_InitTypeDef NVIC_InitStructure;
;;;587        
;;;588        RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM5,ENABLE); //Ã™Ê¹Åœ TIM3 Ê±×“
000006  2101              MOVS     r1,#1
000008  2008              MOVS     r0,#8
00000a  f7fffffe          BL       RCC_APB1PeriphClockCmd
;;;589        TIM_TimeBaseInitStructure.TIM_Period = arr; //Ø”Ö¯×˜×°Õ˜Öµ
00000e  9402              STR      r4,[sp,#8]
;;;590        TIM_TimeBaseInitStructure.TIM_Prescaler=psc; //Ö¨Ê±Ç·Ø–Æµ
000010  f8ad5004          STRH     r5,[sp,#4]
;;;591        TIM_TimeBaseInitStructure.TIM_CounterMode=TIM_CounterMode_Up; //Ð²ÊÝ†Ë½Ä£Ê½
000014  2000              MOVS     r0,#0
000016  f8ad0006          STRH     r0,[sp,#6]
;;;592        TIM_TimeBaseInitStructure.TIM_ClockDivision=TIM_CKD_DIV1;
00001a  f8ad000c          STRH     r0,[sp,#0xc]
;;;593        TIM_TimeBaseInit(TIM5,&TIM_TimeBaseInitStructure);// ÃšÔµÊ¼Û¯Ö¨Ê±Ç· TIM3
00001e  4c0e              LDR      r4,|L7.88|
000020  a901              ADD      r1,sp,#4
000022  4620              MOV      r0,r4
000024  f7fffffe          BL       TIM_TimeBaseInit
;;;594        TIM_ITConfig(TIM5,TIM_IT_Update,ENABLE); //Ã›ÕŠÑ­Ö¨Ê±Ç· 3 Ù¼Ñ‚××
000028  2201              MOVS     r2,#1
00002a  4611              MOV      r1,r2
00002c  4620              MOV      r0,r4
00002e  f7fffffe          BL       TIM_ITConfig
;;;595        NVIC_InitStructure.NVIC_IRQChannel=TIM5_IRQn; //Ö¨Ê±Ç· 3 ××
000032  2132              MOVS     r1,#0x32
000034  f88d1000          STRB     r1,[sp,#0]
;;;596        NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority=0x01; //È€Õ¼Ô…ÐˆÜ¶ 1
000038  2101              MOVS     r1,#1
00003a  f88d1001          STRB     r1,[sp,#1]
;;;597        NVIC_InitStructure.NVIC_IRQChannelSubPriority=0x02; //Ð¬Ó¦Ô…ÐˆÜ¶ 3
00003e  2202              MOVS     r2,#2
000040  f88d2002          STRB     r2,[sp,#2]
;;;598        NVIC_InitStructure.NVIC_IRQChannelCmd=ENABLE;
000044  f88d1003          STRB     r1,[sp,#3]
;;;599        NVIC_Init(&NVIC_InitStructure);// ÃœÔµÊ¼Û¯ NVIC
000048  4668              MOV      r0,sp
00004a  f7fffffe          BL       NVIC_Init
;;;600        TIM_Cmd(TIM5,ENABLE); //ÃÊ¹ÅœÖ¨Ê±Ç· 3
00004e  2101              MOVS     r1,#1
000050  4620              MOV      r0,r4
000052  f7fffffe          BL       TIM_Cmd
;;;601    }
000056  bd7f              POP      {r0-r6,pc}
;;;602    
                          ENDP

                  |L7.88|
                          DCD      0x40000c00

                          AREA ||i.TIM6_Config||, CODE, READONLY, ALIGN=2

                  TIM6_Config PROC
;;;369    
;;;370    void TIM6_Config(void)
000000  b53e              PUSH     {r1-r5,lr}
;;;371    {
;;;372    	TIM_TimeBaseInitTypeDef  TIM_TimeBaseStructure;
;;;373    	/* TIM3 ??? ---------------------------------------------------
;;;374       TIM3 ????(TIM3CLK) ??? APB2 ?? (PCLK2)    
;;;375        => TIM3CLK = PCLK2 = SystemCoreClock
;;;376       TIM3CLK = SystemCoreClock, Prescaler = 0, TIM3 counter clock = SystemCoreClock
;;;377       SystemCoreClock ?48 MHz */
;;;378      /* TIM16 ???? */
;;;379      RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM6,ENABLE);
000002  2101              MOVS     r1,#1
000004  2010              MOVS     r0,#0x10
000006  f7fffffe          BL       RCC_APB1PeriphClockCmd
;;;380    	
;;;381      /* Time ??????*/
;;;382      TIM_TimeBaseStructure.TIM_Prescaler = 4800-1;//?????
00000a  f24120bf          MOV      r0,#0x12bf
00000e  f8ad0000          STRH     r0,[sp,#0]
;;;383      TIM_TimeBaseStructure.TIM_CounterMode = TIM_CounterMode_Up;  /* Time ????????????*/
000012  2000              MOVS     r0,#0
000014  f8ad0002          STRH     r0,[sp,#2]
;;;384      TIM_TimeBaseStructure.TIM_Period = 5000;
000018  f2413188          MOV      r1,#0x1388
00001c  9101              STR      r1,[sp,#4]
;;;385      TIM_TimeBaseStructure.TIM_ClockDivision = TIM_CKD_DIV1;
00001e  f8ad0008          STRH     r0,[sp,#8]
;;;386    //  TIM_TimeBaseStructure.TIM_RepetitionCounter = 0;
;;;387    
;;;388      TIM_TimeBaseInit(TIM6,&TIM_TimeBaseStructure);
000022  4c0a              LDR      r4,|L8.76|
000024  4669              MOV      r1,sp
000026  4620              MOV      r0,r4
000028  f7fffffe          BL       TIM_TimeBaseInit
;;;389    	TIM_ITConfig(TIM6,TIM_IT_Update,ENABLE);//??????§ä??
00002c  2201              MOVS     r2,#1
00002e  4611              MOV      r1,r2
000030  4620              MOV      r0,r4
000032  f7fffffe          BL       TIM_ITConfig
;;;390    	TIM_SetAutoreload(TIM6, 0xFF);//??PWM??¨º
000036  21ff              MOVS     r1,#0xff
000038  4620              MOV      r0,r4
00003a  f7fffffe          BL       TIM_SetAutoreload
;;;391    	TIM6_NVIC_Config();
00003e  f7fffffe          BL       TIM6_NVIC_Config
;;;392      /* TIM3 ?????*/
;;;393      TIM_Cmd(TIM6, ENABLE);
000042  2101              MOVS     r1,#1
000044  4620              MOV      r0,r4
000046  f7fffffe          BL       TIM_Cmd
;;;394    }
00004a  bd3e              POP      {r1-r5,pc}
;;;395    /***********************************************************************/
                          ENDP

                  |L8.76|
                          DCD      0x40001000

                          AREA ||i.TIM6_NVIC_Config||, CODE, READONLY, ALIGN=1

                  TIM6_NVIC_Config PROC
;;;395    /***********************************************************************/
;;;396    static void TIM6_NVIC_Config(void)
000000  b508              PUSH     {r3,lr}
;;;397    {
;;;398    	NVIC_InitTypeDef NVIC_InitStructure; 
;;;399    	
;;;400    	/* Enable the USART1 Interrupt */
;;;401    	NVIC_InitStructure.NVIC_IRQChannel = TIM6_DAC_IRQn;	 
000002  2036              MOVS     r0,#0x36
000004  f88d0000          STRB     r0,[sp,#0]
;;;402    	NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 0x01;
000008  2001              MOVS     r0,#1
00000a  f88d0001          STRB     r0,[sp,#1]
;;;403    	NVIC_InitStructure.NVIC_IRQChannelSubPriority = 0x03;
00000e  2103              MOVS     r1,#3
000010  f88d1002          STRB     r1,[sp,#2]
;;;404    	NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;
000014  f88d0003          STRB     r0,[sp,#3]
;;;405    	NVIC_Init(&NVIC_InitStructure);
000018  4668              MOV      r0,sp
00001a  f7fffffe          BL       NVIC_Init
;;;406    }
00001e  bd08              POP      {r3,pc}
;;;407    
                          ENDP


                          AREA ||.data||, DATA, ALIGN=2

                  usartocflag
000000  00                DCB      0x00
                  usartshortflag
000001  00                DCB      0x00
                  calert
000002  00                DCB      0x00
                  resetflag
000003  00                DCB      0x00
                  resetcount
000004  0000              DCB      0x00,0x00
                  uocount
000006  0000              DCB      0x00,0x00
                  powcount
000008  0000              DCB      0x00,0x00
                  powflag
00000a  0000              DCB      0x00,0x00
                  finishflag
00000c  00000000          DCB      0x00,0x00,0x00,0x00
                  Tick_10ms
                          DCD      0x00000000
                  crec1
                          DCD      0x00000000
                  crec2
                          DCD      0x00000000
                  ctime
                          DCD      0x00000000
                  dctime
                          DCD      0x00000000
                  testi
                          DCD      0x00000000
                  bc_raw
                          DCD      0x00000000
                  cbc_raw
                          DCD      0x00000000
                  c_sum
                          DCD      0x00000000
                  OldTick
                          DCD      0x00000000
                  shortv
                          DCD      0x00000000

                          AREA ||area_number.13||, DATA, ALIGN=1

                          EXPORTAS ||area_number.13||, ||.data||
                  battery_c
000000  0000              DCB      0x00,0x00

                          AREA ||area_number.14||, DATA, ALIGN=0

                          EXPORTAS ||area_number.14||, ||.data||
                  resdone
000000  00                DCB      0x00

                          AREA ||area_number.15||, DATA, ALIGN=2

                          EXPORTAS ||area_number.15||, ||.data||
                  watch
                          DCD      0x00000000

;*** Start embedded assembler ***

#line 1 "..\\drive\\TIM6.c"
	AREA ||.rev16_text||, CODE
	THUMB
	EXPORT |__asm___6_TIM6_c_119e0187____REV16|
#line 129 "D:\\Keil_v5\\ARM\\CMSIS\\Include\\core_cmInstr.h"
|__asm___6_TIM6_c_119e0187____REV16| PROC
#line 130

 rev16 r0, r0
 bx lr
	ENDP
	AREA ||.revsh_text||, CODE
	THUMB
	EXPORT |__asm___6_TIM6_c_119e0187____REVSH|
#line 144
|__asm___6_TIM6_c_119e0187____REVSH| PROC
#line 145

 revsh r0, r0
 bx lr
	ENDP

;*** End   embedded assembler ***
